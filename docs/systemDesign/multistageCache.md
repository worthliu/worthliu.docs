多级缓存,是指在整个系统架构的不同系统层级进行数据缓存,以提升访问效率.

>一般系统整体流程如下:
1. 接入`Nginx`将请求负载均衡到应用`Nginx`,此处常用的负载均衡算法是轮询或者一致性哈希;
  + `轮询可以使服务器的请求更加均衡`;
  + `一致性哈希可以提升应用Nginx的缓存命中率`;
2. 应用`Nginx`读取本地缓存,如果本地缓存命中,则直接返回,使用应用`Nginx`本地缓存可以提升整体的吞吐量,降低后端压力,尤其应对热点问题非常有效;
  + 可以使用`Lua Shared Dict`/`Nginx Proxy Cache(磁盘/内存)`/`Local Redis实现`;
3. 如果`Nginx`本地缓存没命中,则会读取相应的分布式缓存;如果分布式缓存命中,则直接返回相应数据(并回写到`Nginx`本地缓存);
  + 如`Redis`缓存,还可以考虑使用主从架构来提升性能和吞吐量;
4. 如果分布式缓存也没有命中,则会回源到`Tomcat`集群,在回源到`Tomcat`集群时,也可以使用轮询和一致性哈希作为负载均衡算法;
5. 在`Tomcat`应用中,首先读取本地堆缓存.如果有,则直接返回(并会写到主`Redis`集群);
6. 作为可选部分,如果步骤4没有命中,则可以再尝试一次读主`Redis`集群操作,目的是防止当从集群有问题时的流量冲击;
7. 如果所有缓存都没有命中,则只能查询`DB`或相关服务获取相关数据并返回.
8. 步骤7返回的数据异步写到主`Redis`集群,此处可能有多个`Tomcat`实例同时写主`Redis`集群,会造成数据错乱.

